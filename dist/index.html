<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Market Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
            padding: 1rem 2rem;
        }
        
        .container { width: 100%; max-width: none; margin: 0; padding: 0; }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid #334155;
            margin-bottom: 1rem;
        }
        .header-title { font-size: 1.5rem; font-weight: 600; color: #f1f5f9; }
        .header-subtitle { color: #64748b; font-size: 0.75rem; margin-top: 0.25rem; }
        .header-meta { color: #64748b; font-size: 0.7rem; text-align: right; }
        
        /* Period Selector */
        .period-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .period-selector label { color: #94a3b8; font-size: 0.8rem; }
        .period-select {
            background: #1e293b;
            border: 1px solid #334155;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .period-select:focus { outline: none; border-color: #3b82f6; }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 2rem;
            border-bottom: 1px solid #334155;
            margin-bottom: 1.5rem;
        }
        .tab {
            padding: 0.75rem 0;
            color: #94a3b8;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab:hover { color: #e2e8f0; }
        .tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
        .tab-content { display: none; width: 100%; }
        .tab-content.active { display: block; width: 100%; }
        
        /* Regime Header */
        .regime-header {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-left: 4px solid #10b981;
            border-radius: 8px;
            padding: 1.5rem 2rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .regime-label-small { color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; }
        .regime-score-row { display: flex; align-items: baseline; gap: 1rem; margin-top: 0.25rem; }
        .regime-score { font-size: 3.5rem; font-weight: 700; color: #10b981; font-family: 'SF Mono', 'Consolas', monospace; line-height: 1; }
        .regime-delta { font-size: 1.25rem; color: #ef4444; font-family: 'SF Mono', 'Consolas', monospace; }
        .regime-badge { background: #10b98122; border: 1px solid #10b981; color: #10b981; padding: 0.5rem 1.5rem; border-radius: 4px; font-weight: 600; font-size: 1.1rem; }
        .regime-action { color: #94a3b8; font-size: 0.8rem; margin-top: 0.5rem; text-align: right; }
        .regime-footer { color: #64748b; font-size: 0.7rem; margin-bottom: 1rem; }
        
        /* Alerts */
        .alerts-container { margin-bottom: 1rem; }
        .alert { border-radius: 4px; padding: 0.5rem 1rem; font-size: 0.8rem; margin-bottom: 0.5rem; }
        .alert-ok { background: #10b98122; border: 1px solid #10b981; color: #6ee7b7; }
        .alert-high { background: #ef444422; border: 1px solid #ef4444; color: #fca5a5; }
        .alert-elevated { background: #f9731622; border: 1px solid #f97316; color: #fdba74; }
        .alert-level { font-weight: 600; }
        
        /* Chart - force full width */
        .chart-container { 
            margin-bottom: 1rem; 
            width: 100%; 
            box-sizing: border-box;
        }
        #chart { 
            height: 450px; 
            width: 100% !important;
        }
        
        /* Event Legend */
        .event-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 0.5rem 0;
            border-top: 1px solid #334155;
            margin-bottom: 1.5rem;
        }
        .event-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .event-bar {
            width: 3px;
            height: 14px;
            border-radius: 1px;
        }
        .event-date { color: #94a3b8; font-size: 0.75rem; }
        .event-label { color: #e2e8f0; font-size: 0.75rem; }
        
        /* Bottom Grid */
        .bottom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 1024px) { .bottom-grid { grid-template-columns: 1fr; } }
        
        /* Cards */
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 1rem 1.5rem; }
        .card-title { color: #94a3b8; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 1rem; }
        
        /* Signal Breakdown */
        .signal-row { margin-bottom: 0.75rem; }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem; }
        .signal-name { color: #e2e8f0; font-size: 0.85rem; }
        .signal-weight { color: #64748b; font-size: 0.7rem; margin-left: 0.5rem; }
        .signal-value { font-family: 'SF Mono', monospace; font-size: 0.9rem; font-weight: 600; }
        .signal-bar-bg { background: #0f172a; border-radius: 2px; height: 6px; overflow: hidden; }
        .signal-bar { height: 100%; border-radius: 2px; }
        
        /* Current Levels */
        .level-row { display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid #334155; }
        .level-row:last-child { border-bottom: none; }
        .level-name { color: #94a3b8; font-size: 0.8rem; }
        .level-value { color: #e2e8f0; font-family: 'SF Mono', monospace; font-size: 0.85rem; }
        
        /* Indicators Tab */
        .tab-heading { color: #f1f5f9; font-size: 1.5rem; margin-bottom: 0.5rem; }
        .tab-intro { color: #94a3b8; margin-bottom: 1.5rem; }
        .indicator-card { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; }
        .indicator-card-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; }
        .indicator-card-title { color: #f1f5f9; font-size: 1.1rem; margin: 0; }
        .indicator-card-source { color: #64748b; font-size: 0.75rem; margin-top: 0.25rem; }
        .indicator-card-status-wrap { text-align: right; }
        .indicator-status { padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.8rem; border: 1px solid; display: inline-block; }
        .indicator-weight { color: #64748b; font-size: 0.7rem; margin-top: 0.25rem; }
        .indicator-description { color: #cbd5e1; font-size: 0.9rem; margin-bottom: 1rem; }
        .indicator-details { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .indicator-detail-box { background: #0f172a; padding: 0.75rem; border-radius: 4px; }
        .indicator-detail-label { color: #64748b; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 0.25rem; }
        .indicator-detail-value { color: #e2e8f0; font-size: 0.85rem; }
        @media (max-width: 768px) { .indicator-details { grid-template-columns: 1fr; } }
        
        /* Backtest & Models Tabs */
        .section-box { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 1.25rem; margin-bottom: 1.5rem; }
        .section-title { color: #f1f5f9; font-size: 1.1rem; margin: 1.5rem 0 1rem 0; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .metric-box { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 1rem; text-align: center; }
        .metric-value { font-size: 1.5rem; font-weight: 600; margin: 0.25rem 0; }
        .metric-label { color: #64748b; font-size: 0.7rem; text-transform: uppercase; }
        .metric-sublabel { color: #94a3b8; font-size: 0.75rem; }
        .rankings-table { width: 100%; border-collapse: collapse; background: #1e293b; border-radius: 8px; overflow: hidden; margin-bottom: 1.5rem; }
        .rankings-table th { text-align: left; padding: 0.75rem 1rem; color: #94a3b8; font-size: 0.8rem; border-bottom: 1px solid #334155; }
        .rankings-table td { padding: 0.75rem 1rem; color: #e2e8f0; font-size: 0.85rem; border-bottom: 1px solid #334155; }
        .rankings-table tr:last-child td { border-bottom: none; }
        .stress-events { color: #94a3b8; margin-left: 1.25rem; margin-top: 0.5rem; }
        .stress-events li { margin-bottom: 0.25rem; }
        .failed { color: #ef4444 !important; }
        .warning { color: #f59e0b !important; }
        
        /* Stage boxes */
        .stage-row { display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 1rem; }
        .stage-badge { padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; font-size: 0.8rem; color: white; white-space: nowrap; }
        .stage-text { color: #94a3b8; font-size: 0.9rem; }
        .stage-text strong { color: #e2e8f0; }
        
        /* Login overlay */
        .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #0f172a; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-overlay.hidden { display: none; }
        .login-box { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 32px; width: 100%; max-width: 360px; text-align: center; }
        .login-title { font-size: 18px; font-weight: 600; color: #f1f5f9; margin-bottom: 8px; }
        .login-subtitle { font-size: 13px; color: #64748b; margin-bottom: 24px; }
        .login-input { width: 100%; padding: 12px 16px; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: #e2e8f0; font-size: 14px; margin-bottom: 16px; outline: none; }
        .login-input:focus { border-color: #3b82f6; }
        .login-button { width: 100%; padding: 12px 16px; background: #3b82f6; border: none; border-radius: 8px; color: #fff; font-size: 14px; font-weight: 500; cursor: pointer; }
        .login-button:hover { background: #2563eb; }
        .login-error { color: #ef4444; font-size: 13px; margin-top: 12px; display: none; }
        .dashboard-content { display: none; }
        .dashboard-content.visible { display: block; }
    </style>
</head>
<body>
    
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="login-title">Fast Market Dashboard</div>
            <div class="login-subtitle">Enter password to continue</div>
            <input type="password" id="passwordInput" class="login-input" placeholder="Password" autofocus>
            <button id="loginButton" class="login-button">Access Dashboard</button>
            <div id="loginError" class="login-error">Incorrect password</div>
        </div>
    </div>
    
    
    <div class="dashboard-content" id="dashboardContent">
    <div class="container">
        <div class="header">
            <div>
                <div class="header-title">Market Stress Monitor</div>
                <div class="header-subtitle">Asset Management Risk Dashboard</div>
            </div>
            <div class="header-meta">Data: FRED + Yahoo Finance<br>Refresh: Daily EOD</div>
        </div>
        
        <div class="period-selector">
            <label>History Period:</label>
            <select class="period-select" id="periodSelect">
                <option value="90">90 Days</option>
                <option value="180">180 Days</option>
                <option value="365" selected>1 Year</option>
            </select>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="indicators">Indicators</div>
            <div class="tab" data-tab="backtest">Backtest</div>
            <div class="tab" data-tab="models">Models</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="tab-dashboard">
            <div class="regime-header">
                <div>
                    <div class="regime-label-small">Market Stress Level</div>
                    <div class="regime-score-row">
                        <span class="regime-score">25.7</span>
                        <span class="regime-delta">+12.4 (5d)</span>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div class="regime-badge">CALM</div>
                    <div class="regime-action">Risk-on conditions</div>
                </div>
            </div>
            <div class="regime-footer">As of 2026-01-16 | Updated 21:55</div>
            
            <div class="alerts-container">
                <div class="alert alert-high"><span class="alert-level">HIGH:</span> Safe Haven (GLD/SPY) at 99th percentile</div>
            </div>
            
            <div class="chart-container">
                <div id="chart"></div>
            </div>
            
            <div class="event-legend" id="eventLegend"></div>
            
            <div class="bottom-grid">
                <div class="card">
                    <div class="card-title">Signal Breakdown (by contribution)</div>
                    
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name">! Safe Haven (GLD/SPY) <span class="signal-weight">5% wt</span></span>
                    <span class="signal-value" style="color: #fca5a5">99</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 98.80478087649402%; background: #ef4444;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> VIX Term Structure <span class="signal-weight">10% wt</span></span>
                    <span class="signal-value" style="color: #fdba74">77</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 77.47059989613874%; background: #f97316;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> VIX <span class="signal-weight">15% wt</span></span>
                    <span class="signal-value" style="color: #6ee7b7">25</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 25.099601593625497%; background: #10b981;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> Sector Correlation <span class="signal-weight">10% wt</span></span>
                    <span class="signal-value" style="color: #6ee7b7">23</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 23.39541611726483%; background: #10b981;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> USD Index <span class="signal-weight">10% wt</span></span>
                    <span class="signal-value" style="color: #6ee7b7">22</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 21.91235059760956%; background: #10b981;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> Defensive Rotation <span class="signal-weight">10% wt</span></span>
                    <span class="signal-value" style="color: #6ee7b7">22</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 21.51394422310757%; background: #10b981;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> BBB Credit Spread <span class="signal-weight">15% wt</span></span>
                    <span class="signal-value" style="color: #6ee7b7">8</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 7.968127490039841%; background: #10b981;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> HY Credit Spread <span class="signal-weight">20% wt</span></span>
                    <span class="signal-value" style="color: #6ee7b7">7</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 6.772908366533864%; background: #10b981;"></div>
                </div>
            </div>
        
            <div class="signal-row">
                <div class="signal-header">
                    <span class="signal-name"> S&P 500 Drawdown <span class="signal-weight">5% wt</span></span>
                    <span class="signal-value" style="color: #6ee7b7">1</span>
                </div>
                <div class="signal-bar-bg">
                    <div class="signal-bar" style="width: 1.0680395054226142%; background: #10b981;"></div>
                </div>
            </div>
        
                </div>
                <div class="card">
                    <div class="card-title">Current Levels</div>
                    
            <div class="level-row">
                <span class="level-name">HY Credit Spread</span>
                <span class="level-value">2.71%</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">VIX</span>
                <span class="level-value">15.8</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">BBB Credit Spread</span>
                <span class="level-value">0.97%</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">USD Index</span>
                <span class="level-value">120.6</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">Defensive Rotation</span>
                <span class="level-value">0.355</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">Sector Correlation</span>
                <span class="level-value">0.187</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">VIX Term Structure</span>
                <span class="level-value">0.835 (backwardation)</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">Safe Haven (GLD/SPY)</span>
                <span class="level-value">0.609</span>
            </div>
        
            <div class="level-row">
                <span class="level-name">S&P 500 Drawdown</span>
                <span class="level-value">6940</span>
            </div>
        
                </div>
            </div>
        </div>
        
        <!-- Indicators Tab -->
        <div class="tab-content" id="tab-indicators">
            
        <h2 class="tab-heading">Indicator Reference Guide</h2>
        <p class="tab-intro">Each indicator in the composite score is selected based on backtesting against historical stress events.</p>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">High Yield Credit Spread</h3>
                        <div class="indicator-card-source">FRED (BAMLH0A0HYM2)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #10b98122; border-color: #10b981; color: #10b981;">
                            Low: 7
                        </div>
                        <div class="indicator-weight">Weight: 20%</div>
                    </div>
                </div>
                <p class="indicator-description">The spread between high yield (junk) bonds and treasuries. Widens sharply during stress as investors demand more compensation for risk.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = more stress. During crises, spreads can exceed 10%. Normal range is 3-5%.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 2.19x | Detection: 100% (6/6 events)</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">BBB Credit Spread</h3>
                        <div class="indicator-card-source">FRED (BAMLC0A4CBBB)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #10b98122; border-color: #10b981; color: #10b981;">
                            Low: 8
                        </div>
                        <div class="indicator-weight">Weight: 15%</div>
                    </div>
                </div>
                <p class="indicator-description">Spread for BBB-rated corporate bonds (lowest investment grade). Sensitive to downgrade fears.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = more stress. BBB is the largest segment of corporate debt.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 2.18x | Detection: 100% (6/6 events)</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">VIX (Volatility Index)</h3>
                        <div class="indicator-card-source">FRED (VIXCLS)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #10b98122; border-color: #10b981; color: #10b981;">
                            Low: 25
                        </div>
                        <div class="indicator-weight">Weight: 15%</div>
                    </div>
                </div>
                <p class="indicator-description">The 'fear gauge' - measures expected 30-day S&P 500 volatility implied by options prices.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = more fear. Above 30 is elevated, above 40 is panic.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 1.89x | Detection: 100% (6/6 events)</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">Defensive Rotation (XLU/XLY)</h3>
                        <div class="indicator-card-source">Yahoo Finance (derived)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #10b98122; border-color: #10b981; color: #10b981;">
                            Low: 22
                        </div>
                        <div class="indicator-weight">Weight: 10%</div>
                    </div>
                </div>
                <p class="indicator-description">Ratio of Utilities (defensive) to Consumer Discretionary (cyclical). Rising ratio indicates rotation to safety.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = more defensive positioning. Spikes during risk-off periods.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 1.89x | Detection: 100%</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">USD Index</h3>
                        <div class="indicator-card-source">FRED (DTWEXBGS)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #10b98122; border-color: #10b981; color: #10b981;">
                            Low: 22
                        </div>
                        <div class="indicator-weight">Weight: 10%</div>
                    </div>
                </div>
                <p class="indicator-description">Trade-weighted US dollar index. Dollar strengthens as global reserve currency during crises.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = flight to safety. Strong dollar can also create EM stress.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 1.73x | Detection: 100% (6/6 events)</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">Sector Correlation</h3>
                        <div class="indicator-card-source">Yahoo Finance (derived)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #10b98122; border-color: #10b981; color: #10b981;">
                            Low: 23
                        </div>
                        <div class="indicator-weight">Weight: 10%</div>
                    </div>
                </div>
                <p class="indicator-description">Average pairwise correlation of S&P sector ETFs (60-day rolling). High correlation means diversification breaks down.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = more stress. When all sectors move together, it signals panic selling.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 1.75x | Detection: 100%</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">VIX Term Structure</h3>
                        <div class="indicator-card-source">Yahoo Finance (VIX/VIX3M)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #ef444422; border-color: #ef4444; color: #ef4444;">
                            Elevated: 77
                        </div>
                        <div class="indicator-weight">Weight: 10%</div>
                    </div>
                </div>
                <p class="indicator-description">Ratio of spot VIX to 3-month VIX. Normally in contango (>1). Backwardation (<1) signals panic.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Below 1.0 = backwardation = panic. Below 0.9 = severe stress.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 1.63x | Detection: 100%</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">Safe Haven Demand (GLD/SPY)</h3>
                        <div class="indicator-card-source">Yahoo Finance (derived)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #ef444422; border-color: #ef4444; color: #ef4444;">
                            Elevated: 99
                        </div>
                        <div class="indicator-weight">Weight: 5%</div>
                    </div>
                </div>
                <p class="indicator-description">Ratio of gold to S&P 500. Rising ratio indicates flight to gold as safe haven.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = more fear. Gold outperforms equities during stress.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: 1.38x | Detection: 100%</div>
                    </div>
                </div>
            </div>
        
            <div class="indicator-card">
                <div class="indicator-card-header">
                    <div>
                        <h3 class="indicator-card-title">S&P 500 Drawdown</h3>
                        <div class="indicator-card-source">FRED (SP500)</div>
                    </div>
                    <div class="indicator-card-status-wrap">
                        <div class="indicator-status" style="background: #10b98122; border-color: #10b981; color: #10b981;">
                            Low: 1
                        </div>
                        <div class="indicator-weight">Weight: 5%</div>
                    </div>
                </div>
                <p class="indicator-description">Current drawdown from 52-week high. Direct measure of equity market stress.</p>
                <div class="indicator-details">
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Interpretation</div>
                        <div class="indicator-detail-value">Higher = deeper drawdown. 10%+ is correction, 20%+ is bear market.</div>
                    </div>
                    <div class="indicator-detail-box">
                        <div class="indicator-detail-label">Backtest Performance</div>
                        <div class="indicator-detail-value">Signal Ratio: N/A | Detection: 100%</div>
                    </div>
                </div>
            </div>
        
    
        </div>
        
        <!-- Backtest Tab -->
        <div class="tab-content" id="tab-backtest">
            
        <h2 class="tab-heading">Backtesting Methodology & Results</h2>
        
        <div class="section-box">
            <h3 style="color: #f1f5f9; margin-bottom: 0.75rem;">How We Test Indicators</h3>
            <p style="color: #94a3b8;">Each indicator is evaluated against <strong style="color: #e2e8f0;">6 major market stress events</strong>:</p>
            <ul class="stress-events">
                <li><strong>2008-09:</strong> Financial Crisis (56.8% drawdown)</li>
                <li><strong>2011:</strong> Debt Ceiling Crisis (19.4% drawdown)</li>
                <li><strong>2015:</strong> China Devaluation (12.4% drawdown)</li>
                <li><strong>2018:</strong> Fed Tightening (19.8% drawdown)</li>
                <li><strong>2020:</strong> COVID Crash (33.9% drawdown)</li>
                <li><strong>2022:</strong> Rate Shock (25.4% drawdown)</li>
            </ul>
        </div>
        
        <div class="metrics-grid">
            <div class="section-box">
                <h4 style="color: #f1f5f9; margin-bottom: 0.5rem;">Signal Ratio</h4>
                <p style="color: #94a3b8; font-size: 0.85rem;">Average percentile during stress / Average during normal times.</p>
                <p style="color: #10b981; font-size: 0.85rem; margin-top: 0.5rem;">Higher is better. 2.0x = twice as elevated during stress.</p>
            </div>
            <div class="section-box">
                <h4 style="color: #f1f5f9; margin-bottom: 0.5rem;">Detection Rate</h4>
                <p style="color: #94a3b8; font-size: 0.85rem;">% of stress events where indicator exceeded 70th percentile.</p>
                <p style="color: #10b981; font-size: 0.85rem; margin-top: 0.5rem;">Higher is better. 100% = caught every major event.</p>
            </div>
        </div>
        
        <h3 class="section-title">Indicator Rankings</h3>
        <table class="rankings-table">
            <thead><tr><th>Indicator</th><th>Signal Ratio</th><th>Detection</th><th>Tier</th></tr></thead>
            <tbody>
                <tr><td>HY Credit Spread</td><td>2.19x</td><td>100%</td><td>1</td></tr>
                <tr><td>BBB Credit Spread</td><td>2.18x</td><td>100%</td><td>1</td></tr>
                <tr><td>VIX</td><td>1.89x</td><td>100%</td><td>2</td></tr>
                <tr><td>Defensive Rotation</td><td>1.89x</td><td>100%</td><td>2</td></tr>
                <tr><td>USD Index</td><td>1.73x</td><td>100%</td><td>2</td></tr>
                <tr><td>Sector Correlation</td><td>1.75x</td><td>100%</td><td>3</td></tr>
                <tr><td>VIX Term Structure</td><td>1.63x</td><td>100%</td><td>3</td></tr>
                <tr><td>Safe Haven (GLD/SPY)</td><td>1.38x</td><td>100%</td><td>4</td></tr>
                <tr><td>S&P 500 Drawdown</td><td>N/A</td><td>100%</td><td>4</td></tr>
            </tbody>
        </table>
        
        <h3 class="section-title">What Didn't Work</h3>
        <table class="rankings-table">
            <thead><tr><th>Indicator</th><th>Signal Ratio</th><th>Problem</th></tr></thead>
            <tbody>
                <tr><td class="failed">RSI (SPY, QQQ, IWM)</td><td class="failed">0.53-0.58x</td><td>Goes DOWN during stress</td></tr>
                <tr><td class="failed">10Y-2Y Spread</td><td class="failed">0.61x</td><td>Only 33% detection - too slow</td></tr>
                <tr><td class="failed">SKEW Index</td><td class="failed">0.22x</td><td>Opposite of expected</td></tr>
                <tr><td class="warning">Fed Funds Rate</td><td class="warning">1.02x</td><td>Policy-driven, not market</td></tr>
            </tbody>
        </table>
    
        </div>
        
        <!-- Models Tab -->
        <div class="tab-content" id="tab-models">
            
        <h2 class="tab-heading">Linear vs Non-Linear Models</h2>
        <p class="tab-intro">Testing whether non-linear relationships improve fast market detection.</p>
        
        <div class="section-box">
            <h4 style="color: #ef4444; margin-bottom: 0.75rem;">What Linear Models Miss</h4>
            <ul style="color: #94a3b8; padding-left: 1.25rem;">
                <li style="margin-bottom: 0.5rem;"><strong style="color: #e2e8f0;">Convexity at extremes</strong> - Going from 70th to 85th percentile is fundamentally different than 40th to 55th.</li>
                <li style="margin-bottom: 0.5rem;"><strong style="color: #e2e8f0;">Convergence effects</strong> - When VIX, credit, and USD all spike together, it's multiplicative, not additive.</li>
                <li style="margin-bottom: 0.5rem;"><strong style="color: #e2e8f0;">Regime shifts</strong> - In calm markets, credit leads. In stress, everything correlates.</li>
                <li><strong style="color: #e2e8f0;">Lead-lag relationships</strong> - Credit spreads widen before equities fall.</li>
            </ul>
        </div>
        
        <h3 class="section-title">Backtest Results: 6 Major Stress Events</h3>
        <table class="rankings-table">
            <thead><tr><th>Event</th><th>Linear</th><th>Hybrid</th></tr></thead>
            <tbody>
                <tr><td>Financial Crisis (2008)</td><td>72</td><td style="color: #10b981;">95</td></tr>
                <tr><td>Debt Ceiling (2011)</td><td>72</td><td style="color: #10b981;">95</td></tr>
                <tr><td>China Devaluation (2015)</td><td>72</td><td style="color: #10b981;">95</td></tr>
                <tr><td>Fed Tightening (2018)</td><td>71</td><td style="color: #10b981;">93</td></tr>
                <tr><td>COVID Crash (2020)</td><td>73</td><td style="color: #10b981;">95</td></tr>
                <tr><td>Rate Shock (2022)</td><td>72</td><td style="color: #10b981;">99</td></tr>
            </tbody>
        </table>
        
        <h3 class="section-title">Model Performance</h3>
        <div class="metrics-grid">
            <div class="metric-box">
                <div class="metric-label">Signal Ratio</div>
                <div class="metric-value" style="color: #3b82f6;">+24%</div>
                <div class="metric-sublabel">Hybrid vs Linear</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">Peak Score</div>
                <div class="metric-value" style="color: #10b981;">95-99</div>
                <div class="metric-sublabel">Hybrid in stress</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">Lead Time</div>
                <div class="metric-value" style="color: #f59e0b;">+0.8d</div>
                <div class="metric-sublabel">Early warning</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">Precision</div>
                <div class="metric-value" style="color: #ef4444;">-28%</div>
                <div class="metric-sublabel">More false positives</div>
            </div>
        </div>
        
        <h3 class="section-title">Practical Recommendation</h3>
        <div class="section-box" style="background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%); border-color: #3b82f6;">
            <h4 style="color: #f1f5f9; margin-bottom: 1rem;">Two-Stage Monitoring Approach</h4>
            <div class="stage-row">
                <span class="stage-badge" style="background: #10b981;">STAGE 1</span>
                <span class="stage-text">Use <strong>Linear model</strong> for daily monitoring. Fewer false alarms, stable baseline.</span>
            </div>
            <div class="stage-row">
                <span class="stage-badge" style="background: #f59e0b;">STAGE 2</span>
                <span class="stage-text">When Linear crosses <strong>50+</strong>, switch to <strong>Hybrid lens</strong> for amplified signal.</span>
            </div>
            <div class="stage-row">
                <span class="stage-badge" style="background: #ef4444;">STAGE 3</span>
                <span class="stage-text">If Hybrid exceeds <strong>85</strong>, treat as confirmed fast market.</span>
            </div>
        </div>
    
        </div>
    </div>
    </div>
    
    <script>
        // Market Events
        const MARKET_EVENTS = [{"date": "2025-01-27", "label": "DeepSeek shock", "color": "#ef4444"}, {"date": "2025-04-02", "label": "Liberation Day tariffs", "color": "#ef4444"}, {"date": "2025-04-09", "label": "90-day tariff pause", "color": "#10b981"}, {"date": "2025-06-27", "label": "New all-time high", "color": "#10b981"}, {"date": "2025-11-18", "label": "VIX spike to 52", "color": "#ef4444"}, {"date": "2025-12-10", "label": "Fed hawkish pivot", "color": "#f59e0b"}];
        
        // Chart data
        const CHART_DATA = {
            dates: ["2024-08-05", "2024-08-06", "2024-08-07", "2024-08-08", "2024-08-09", "2024-08-12", "2024-08-13", "2024-08-14", "2024-08-15", "2024-08-16", "2024-08-19", "2024-08-20", "2024-08-21", "2024-08-22", "2024-08-23", "2024-08-26", "2024-08-27", "2024-08-28", "2024-08-29", "2024-08-30", "2024-09-03", "2024-09-04", "2024-09-05", "2024-09-06", "2024-09-09", "2024-09-10", "2024-09-11", "2024-09-12", "2024-09-13", "2024-09-16", "2024-09-17", "2024-09-18", "2024-09-19", "2024-09-20", "2024-09-23", "2024-09-24", "2024-09-25", "2024-09-26", "2024-09-27", "2024-09-30", "2024-10-01", "2024-10-02", "2024-10-03", "2024-10-04", "2024-10-07", "2024-10-08", "2024-10-09", "2024-10-10", "2024-10-11", "2024-10-14", "2024-10-15", "2024-10-16", "2024-10-17", "2024-10-18", "2024-10-21", "2024-10-22", "2024-10-23", "2024-10-24", "2024-10-25", "2024-10-28", "2024-10-29", "2024-10-30", "2024-10-31", "2024-11-01", "2024-11-04", "2024-11-05", "2024-11-06", "2024-11-07", "2024-11-08", "2024-11-11", "2024-11-12", "2024-11-13", "2024-11-14", "2024-11-15", "2024-11-18", "2024-11-19", "2024-11-20", "2024-11-21", "2024-11-22", "2024-11-25", "2024-11-26", "2024-11-27", "2024-11-29", "2024-12-02", "2024-12-03", "2024-12-04", "2024-12-05", "2024-12-06", "2024-12-09", "2024-12-10", "2024-12-11", "2024-12-12", "2024-12-13", "2024-12-16", "2024-12-17", "2024-12-18", "2024-12-19", "2024-12-20", "2024-12-23", "2024-12-24", "2024-12-26", "2024-12-27", "2024-12-30", "2024-12-31", "2025-01-02", "2025-01-03", "2025-01-06", "2025-01-07", "2025-01-08", "2025-01-10", "2025-01-13", "2025-01-14", "2025-01-15", "2025-01-16", "2025-01-17", "2025-01-21", "2025-01-22", "2025-01-23", "2025-01-24", "2025-01-27", "2025-01-28", "2025-01-29", "2025-01-30", "2025-01-31", "2025-02-03", "2025-02-04", "2025-02-05", "2025-02-06", "2025-02-07", "2025-02-10", "2025-02-11", "2025-02-12", "2025-02-13", "2025-02-14", "2025-02-18", "2025-02-19", "2025-02-20", "2025-02-21", "2025-02-24", "2025-02-25", "2025-02-26", "2025-02-27", "2025-02-28", "2025-03-03", "2025-03-04", "2025-03-05", "2025-03-06", "2025-03-07", "2025-03-10", "2025-03-11", "2025-03-12", "2025-03-13", "2025-03-14", "2025-03-17", "2025-03-18", "2025-03-19", "2025-03-20", "2025-03-21", "2025-03-24", "2025-03-25", "2025-03-26", "2025-03-27", "2025-03-28", "2025-03-31", "2025-04-01", "2025-04-02", "2025-04-03", "2025-04-04", "2025-04-07", "2025-04-08", "2025-04-09", "2025-04-10", "2025-04-11", "2025-04-14", "2025-04-15", "2025-04-16", "2025-04-17", "2025-04-21", "2025-04-22", "2025-04-23", "2025-04-24", "2025-04-25", "2025-04-28", "2025-04-29", "2025-04-30", "2025-05-01", "2025-05-02", "2025-05-05", "2025-05-06", "2025-05-07", "2025-05-08", "2025-05-09", "2025-05-12", "2025-05-13", "2025-05-14", "2025-05-15", "2025-05-16", "2025-05-19", "2025-05-20", "2025-05-21", "2025-05-22", "2025-05-23", "2025-05-27", "2025-05-28", "2025-05-29", "2025-05-30", "2025-06-02", "2025-06-03", "2025-06-04", "2025-06-05", "2025-06-06", "2025-06-09", "2025-06-10", "2025-06-11", "2025-06-12", "2025-06-13", "2025-06-16", "2025-06-17", "2025-06-18", "2025-06-20", "2025-06-23", "2025-06-24", "2025-06-25", "2025-06-26", "2025-06-27", "2025-06-30", "2025-07-01", "2025-07-02", "2025-07-03", "2025-07-07", "2025-07-08", "2025-07-09", "2025-07-10", "2025-07-11", "2025-07-14", "2025-07-15", "2025-07-16", "2025-07-17", "2025-07-18", "2025-07-21", "2025-07-22", "2025-07-23", "2025-07-24", "2025-07-25", "2025-07-28", "2025-07-29", "2025-07-30", "2025-07-31", "2025-08-01", "2025-08-04", "2025-08-05", "2025-08-06", "2025-08-07", "2025-08-08", "2025-08-11", "2025-08-12", "2025-08-13", "2025-08-14", "2025-08-15", "2025-08-18", "2025-08-19", "2025-08-20", "2025-08-21", "2025-08-22", "2025-08-25", "2025-08-26", "2025-08-27", "2025-08-28", "2025-08-29", "2025-09-02", "2025-09-03", "2025-09-04", "2025-09-05", "2025-09-08", "2025-09-09", "2025-09-10", "2025-09-11", "2025-09-12", "2025-09-15", "2025-09-16", "2025-09-17", "2025-09-18", "2025-09-19", "2025-09-22", "2025-09-23", "2025-09-24", "2025-09-25", "2025-09-26", "2025-09-29", "2025-09-30", "2025-10-01", "2025-10-02", "2025-10-03", "2025-10-06", "2025-10-07", "2025-10-08", "2025-10-09", "2025-10-10", "2025-10-13", "2025-10-14", "2025-10-15", "2025-10-16", "2025-10-17", "2025-10-20", "2025-10-21", "2025-10-22", "2025-10-23", "2025-10-24", "2025-10-27", "2025-10-28", "2025-10-29", "2025-10-30", "2025-10-31", "2025-11-03", "2025-11-04", "2025-11-05", "2025-11-06", "2025-11-07", "2025-11-10", "2025-11-11", "2025-11-12", "2025-11-13", "2025-11-14", "2025-11-17", "2025-11-18", "2025-11-19", "2025-11-20", "2025-11-21", "2025-11-24", "2025-11-25", "2025-11-26", "2025-11-28", "2025-12-01", "2025-12-02", "2025-12-03", "2025-12-04", "2025-12-05", "2025-12-08", "2025-12-09", "2025-12-10", "2025-12-11", "2025-12-12", "2025-12-15", "2025-12-16", "2025-12-17", "2025-12-18", "2025-12-19", "2025-12-22", "2025-12-23", "2025-12-24", "2025-12-26", "2025-12-29", "2025-12-30", "2025-12-31", "2026-01-02", "2026-01-05", "2026-01-06", "2026-01-07", "2026-01-08", "2026-01-09", "2026-01-12", "2026-01-13", "2026-01-14", "2026-01-15", "2026-01-16"],
            values: [80.8, 73.3, 72.0, 68.9, 66.3, 68.8, 65.3, 57.6, 51.1, 48.5, 41.5, 47.7, 49.9, 50.0, 41.4, 39.9, 40.9, 45.4, 40.2, 37.6, 61.4, 62.5, 58.7, 64.7, 62.7, 66.2, 62.6, 58.1, 53.6, 51.7, 49.3, 47.5, 32.6, 36.2, 35.7, 38.7, 38.6, 30.9, 35.1, 31.0, 38.2, 36.9, 40.0, 38.6, 42.0, 43.1, 43.2, 44.3, 43.2, 42.5, 45.2, 45.8, 45.4, 43.0, 45.3, 45.7, 48.3, 47.3, 48.2, 47.6, 47.3, 48.1, 50.2, 49.7, 49.6, 48.1, 41.9, 38.3, 38.1, 38.1, 37.3, 34.8, 35.4, 42.5, 40.8, 42.8, 44.5, 43.2, 38.8, 36.8, 35.3, 34.8, 32.5, 31.6, 30.7, 31.2, 31.5, 25.9, 34.9, 35.4, 31.3, 34.1, 34.8, 39.5, 44.9, 54.5, 57.1, 50.6, 47.9, 39.2, 41.8, 45.8, 52.2, 51.7, 51.0, 45.5, 44.7, 48.8, 49.6, 52.7, 52.7, 50.6, 43.0, 45.5, 39.9, 34.8, 34.3, 34.1, 32.8, 44.2, 41.4, 43.2, 39.0, 43.5, 50.4, 45.5, 39.6, 36.6, 42.6, 38.2, 39.0, 37.7, 33.5, 30.5, 32.8, 37.1, 35.4, 49.5, 51.1, 53.8, 52.0, 56.2, 57.1, 61.6, 63.5, 56.1, 60.6, 59.5, 71.7, 77.4, 74.2, 83.0, 76.6, 68.6, 75.0, 68.4, 66.8, 70.4, 52.2, 53.3, 64.7, 72.8, 81.8, 83.4, 81.8, 79.7, 84.2, 86.1, 88.2, 88.6, 85.4, 83.9, 80.7, 79.3, 79.2, 78.4, 77.0, 75.2, 74.2, 75.3, 73.8, 72.9, 72.5, 71.6, 72.2, 73.2, 68.3, 67.7, 68.0, 67.2, 67.6, 66.1, 50.0, 44.1, 45.0, 50.2, 46.5, 49.9, 47.5, 56.0, 57.4, 60.0, 50.6, 52.0, 49.7, 52.1, 48.9, 39.9, 44.1, 41.1, 32.1, 34.2, 33.9, 34.5, 38.7, 46.3, 38.7, 46.7, 44.1, 44.1, 42.3, 31.6, 29.1, 28.2, 26.6, 27.0, 25.9, 23.7, 19.2, 26.9, 27.2, 23.8, 21.9, 27.5, 30.3, 31.2, 32.2, 25.8, 26.2, 25.3, 24.4, 15.5, 15.6, 15.2, 16.1, 22.3, 23.9, 28.3, 49.0, 37.2, 37.1, 32.7, 30.5, 23.1, 28.5, 20.9, 18.8, 20.5, 19.9, 20.1, 25.5, 28.4, 35.1, 17.2, 14.6, 13.9, 15.5, 12.2, 18.2, 35.5, 26.9, 21.3, 18.0, 18.3, 20.7, 19.4, 12.8, 14.3, 16.6, 20.5, 17.9, 15.7, 15.4, 17.3, 20.7, 20.1, 27.5, 19.0, 21.1, 24.8, 25.8, 29.1, 26.8, 24.5, 33.9, 31.6, 43.0, 63.2, 58.3, 60.0, 54.2, 60.9, 56.6, 49.9, 49.3, 53.0, 47.6, 36.3, 26.3, 31.2, 29.9, 40.3, 48.3, 51.4, 59.9, 55.6, 60.8, 60.1, 51.8, 50.6, 50.5, 57.2, 57.5, 63.2, 68.5, 66.6, 68.4, 68.2, 62.6, 56.0, 47.0, 38.3, 41.8, 38.3, 31.0, 27.7, 24.5, 35.7, 36.0, 29.5, 18.8, 26.2, 30.0, 34.9, 43.0, 36.2, 21.5, 15.8, 11.2, 11.0, 13.4, 14.7, 12.1, 12.8, 12.4, 11.9, 10.2, 14.3, 14.1, 10.1, 13.3, 17.9, 24.0, 16.0, 16.0],
            sp500: [0.0, 1.04, 0.25, 2.56, 3.04, 3.05, 4.78, 5.18, 6.88, 7.09, 8.14, 7.92, 8.38, 7.41, 8.64, 8.3, 8.47, 7.83, 7.82, 8.91, 6.61, 6.43, 6.11, 4.28, 5.49, 5.96, 7.09, 7.89, 8.48, 8.61, 8.64, 8.33, 10.17, 9.95, 10.26, 10.54, 10.33, 10.78, 10.64, 11.11, 10.07, 10.09, 9.9, 10.89, 9.83, 10.89, 11.68, 11.45, 12.12, 12.99, 12.13, 12.65, 12.63, 13.08, 12.87, 12.82, 11.78, 12.02, 11.99, 12.29, 12.47, 12.1, 10.01, 10.46, 10.15, 11.5, 14.32, 15.17, 15.6, 15.71, 15.38, 15.41, 14.71, 13.19, 13.64, 14.09, 14.09, 14.7, 15.1, 15.45, 16.11, 15.66, 16.31, 16.6, 16.65, 17.36, 17.14, 17.43, 16.71, 16.36, 17.31, 16.68, 16.67, 17.12, 16.66, 13.22, 13.13, 14.36, 15.19, 16.46, 16.41, 15.13, 13.89, 13.41, 13.15, 14.58, 15.21, 13.93, 14.11, 12.35, 12.53, 12.66, 14.72, 14.48, 15.62, 16.64, 17.35, 17.98, 17.64, 15.93, 16.99, 16.45, 17.06, 16.47, 15.58, 16.42, 16.87, 17.3, 16.19, 16.97, 17.01, 16.69, 17.91, 17.9, 18.19, 18.47, 17.95, 15.94, 15.37, 14.83, 14.84, 13.02, 14.81, 12.79, 11.41, 12.65, 10.65, 11.26, 8.26, 7.44, 7.96, 6.46, 8.73, 9.42, 8.26, 9.43, 9.19, 9.28, 11.21, 11.38, 10.14, 9.78, 7.61, 8.2, 8.61, 9.34, 4.05, -2.16, -2.39, -3.92, 5.22, 1.58, 3.41, 4.23, 4.05, 1.72, 1.86, -0.54, 1.96, 3.65, 5.75, 6.53, 6.6, 7.22, 7.38, 8.06, 9.65, 8.95, 8.11, 8.58, 9.21, 9.13, 12.68, 13.5, 13.62, 14.09, 14.89, 14.99, 14.54, 12.69, 12.64, 11.89, 14.18, 13.54, 14.0, 13.99, 14.45, 15.12, 15.13, 14.52, 15.7, 15.8, 16.44, 16.12, 16.56, 15.24, 16.33, 15.36, 15.32, 15.07, 16.17, 17.47, 17.47, 18.41, 19.03, 19.64, 19.51, 20.07, 21.08, 20.12, 20.04, 20.76, 21.1, 20.7, 20.87, 20.39, 20.77, 21.42, 21.41, 21.58, 21.66, 22.61, 22.69, 23.18, 23.2, 22.84, 22.69, 22.23, 20.28, 22.05, 21.46, 22.34, 22.24, 23.2, 22.89, 24.28, 24.69, 24.72, 24.36, 24.35, 23.62, 23.32, 22.83, 24.69, 24.16, 24.67, 24.97, 25.37, 24.56, 23.7, 24.33, 25.37, 24.97, 25.24, 25.57, 25.95, 27.02, 26.95, 27.55, 27.39, 27.26, 27.87, 28.5, 29.07, 28.36, 27.99, 27.35, 28.1, 28.44, 28.96, 29.4, 29.48, 29.49, 29.96, 29.47, 30.22, 29.86, 26.34, 28.31, 28.11, 28.63, 27.82, 28.49, 29.86, 29.87, 29.17, 29.93, 30.95, 32.56, 32.87, 32.86, 31.54, 31.89, 32.12, 30.57, 31.04, 29.58, 29.74, 31.74, 32.01, 32.1, 29.91, 29.84, 28.65, 27.59, 28.07, 26.08, 27.32, 29.28, 30.46, 31.36, 32.06, 31.36, 31.68, 32.07, 32.22, 32.47, 32.01, 31.9, 32.79, 33.06, 31.64, 31.43, 31.12, 29.6, 30.63, 31.78, 32.63, 33.23, 33.66, 33.62, 33.15, 32.97, 31.99, 32.24, 33.08, 33.91, 33.45, 33.46, 34.32, 34.53, 34.27, 33.55, 33.9, 33.81]
        };
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                // Resize chart when switching to dashboard tab
                if (tab.dataset.tab === 'dashboard') {
                    setTimeout(() => Plotly.Plots.resize('chart'), 100);
                }
            });
        });
        
        // Period selector
        document.getElementById('periodSelect').addEventListener('change', (e) => {
            renderChart(parseInt(e.target.value));
        });
        
        // Resize chart on window resize
        window.addEventListener('resize', () => {
            Plotly.Plots.resize('chart');
        });
        
        function renderChart(days) {
            const endIdx = CHART_DATA.dates.length;
            const startIdx = Math.max(0, endIdx - days);
            const dates = CHART_DATA.dates.slice(startIdx);
            const values = CHART_DATA.values.slice(startIdx);
            const sp500 = CHART_DATA.sp500.slice(startIdx);
            
            // Recalculate S&P returns from period start (rebased to 0)
            const sp500Base = sp500[0] || 0;
            const sp500Adjusted = sp500.map(v => v - sp500Base);
            
            // Filter events for this period
            const startDate = dates[0];
            const endDate = dates[dates.length - 1];
            const visibleEvents = MARKET_EVENTS.filter(e => e.date >= startDate && e.date <= endDate);
            
            // Build shapes for regime bands and event lines
            const shapes = [
                { type: 'rect', xref: 'paper', x0: 0, x1: 1, y0: 0, y1: 30, fillcolor: '#10b981', opacity: 0.08, line: { width: 0 }, yref: 'y' },
                { type: 'rect', xref: 'paper', x0: 0, x1: 1, y0: 30, y1: 50, fillcolor: '#f59e0b', opacity: 0.08, line: { width: 0 }, yref: 'y' },
                { type: 'rect', xref: 'paper', x0: 0, x1: 1, y0: 50, y1: 70, fillcolor: '#f97316', opacity: 0.08, line: { width: 0 }, yref: 'y' },
                { type: 'rect', xref: 'paper', x0: 0, x1: 1, y0: 70, y1: 100, fillcolor: '#ef4444', opacity: 0.08, line: { width: 0 }, yref: 'y' },
                { type: 'line', xref: 'paper', x0: 0, x1: 1, y0: 30, y1: 30, line: { color: '#475569', width: 1, dash: 'dot' }, yref: 'y' },
                { type: 'line', xref: 'paper', x0: 0, x1: 1, y0: 50, y1: 50, line: { color: '#475569', width: 1, dash: 'dot' }, yref: 'y' },
                { type: 'line', xref: 'paper', x0: 0, x1: 1, y0: 70, y1: 70, line: { color: '#475569', width: 1, dash: 'dot' }, yref: 'y' },
            ];
            
            visibleEvents.forEach(e => {
                shapes.push({
                    type: 'line', x0: e.date, x1: e.date, y0: 0, y1: 1, yref: 'paper',
                    line: { color: e.color, width: 1.5, dash: 'dash' }
                });
            });
            
            // Stress score trace
            const traceStress = {
                x: dates, y: values,
                type: 'scatter', mode: 'lines',
                line: { color: '#3b82f6', width: 2.5 },
                fill: 'tozeroy', fillcolor: 'rgba(59, 130, 246, 0.15)',
                name: 'Stress Score',
                yaxis: 'y',
                hovertemplate: 'Stress: %{y:.1f}<extra></extra>',
            };
            
            // S&P 500 return trace - plot actual values, invert the AXIS (not the data)
            const traceSP500 = {
                x: dates, y: sp500Adjusted,
                type: 'scatter', mode: 'lines',
                line: { color: '#a855f7', width: 2 },
                name: 'S&P 500 Return',
                yaxis: 'y2',
                hovertemplate: 'S&P: %{y:+.1f}%<extra></extra>',
            };
            
            // Calculate y2 range - INVERTED (high values at bottom, low at top)
            const minSP = Math.min(...sp500Adjusted);
            const maxSP = Math.max(...sp500Adjusted);
            const spPadding = Math.max(5, (maxSP - minSP) * 0.1);
            
            const layout = {
                autosize: true,
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent',
                margin: { t: 30, r: 80, b: 50, l: 60 },
                xaxis: { showgrid: true, gridcolor: '#1e293b', color: '#64748b', tickfont: { size: 11 }, tickformat: '%b %d' },
                yaxis: { 
                    showgrid: true, gridcolor: '#1e293b', color: '#3b82f6', tickfont: { size: 11, color: '#3b82f6' }, 
                    range: [0, 100], dtick: 25, title: { text: 'Stress Score', font: { size: 12, color: '#3b82f6' } },
                    side: 'left'
                },
                yaxis2: {
                    overlaying: 'y', side: 'right',
                    showgrid: false, color: '#a855f7', tickfont: { size: 11, color: '#a855f7' },
                    range: [maxSP + spPadding, minSP - spPadding],  // INVERTED: high at bottom
                    tickformat: '+.0f',
                    ticksuffix: '%',
                    title: { text: 'S&P 500 Return (inv)', font: { size: 12, color: '#a855f7' } }
                },
                shapes: shapes,
                hovermode: 'x unified',
                showlegend: true,
                legend: { orientation: 'h', x: 0.5, xanchor: 'center', y: 1.08, font: { size: 11, color: '#e2e8f0' }, bgcolor: 'rgba(0,0,0,0)' },
            };
            
            const config = { 
                displayModeBar: false, 
                responsive: true,
            };
            Plotly.newPlot('chart', [traceStress, traceSP500], layout, config);
            
            // Force resize after render
            window.dispatchEvent(new Event('resize'));
            
            // Update event legend
            const legendEl = document.getElementById('eventLegend');
            if (visibleEvents.length > 0) {
                legendEl.innerHTML = visibleEvents.map(e => {
                    const dateStr = new Date(e.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    return '<div class="event-item"><div class="event-bar" style="background: ' + e.color + ';"></div><span class="event-date">' + dateStr + '</span><span class="event-label">' + e.label + '</span></div>';
                }).join('');
            } else {
                legendEl.innerHTML = '';
            }
        }
        
        // Initialize chart - defer if dashboard is hidden (password protected)
        let chartInitialized = false;
        function initChart() {
            if (chartInitialized) return;
            const dashboard = document.getElementById('dashboardContent');
            if (dashboard && dashboard.classList.contains('visible')) {
                renderChart(365);
                chartInitialized = true;
                setTimeout(() => Plotly.Plots.resize('chart'), 100);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // Try to init chart if dashboard is already visible (no password)
            initChart();
        });
    </script>
    
    <script>
        const HASH = "6c2a0686c2c95dd78a8187b9e2dcfed6340e42a3477952666326cfbc7a6eecbc";
        async function sha256(text) {
            const encoder = new TextEncoder();
            const data = encoder.encode(text);
            const hashBuffer = await crypto.subtle.digest("SHA-256", data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
        }
        async function checkAuth() {
            const stored = sessionStorage.getItem("dashboard_auth");
            if (stored === HASH) showDashboard();
        }
        function showDashboard() {
            document.getElementById("loginOverlay").classList.add("hidden");
            document.getElementById("dashboardContent").classList.add("visible");
            // Initialize chart after dashboard becomes visible
            setTimeout(() => {
                if (typeof initChart === 'function') {
                    initChart();
                }
            }, 50);
        }
        async function handleLogin() {
            const password = document.getElementById("passwordInput").value;
            const hash = await sha256(password);
            if (hash === HASH) {
                sessionStorage.setItem("dashboard_auth", hash);
                showDashboard();
            } else {
                document.getElementById("loginError").style.display = "block";
                document.getElementById("passwordInput").value = "";
            }
        }
        document.getElementById("loginButton").addEventListener("click", handleLogin);
        document.getElementById("passwordInput").addEventListener("keypress", (e) => {
            if (e.key === "Enter") handleLogin();
        });
        checkAuth();
    </script>
    
</body>
</html>